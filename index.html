<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>User Switcher Void</title>
<style>
  body {
    background: #000;
    color: #0f0;
    font-family: monospace;
    margin: 0;
    padding: 0;
  }
  #app {
    display: flex;
    height: 100vh;
  }
  #left-panel {
    width: 320px;
    background: #111;
    padding: 20px;
    box-sizing: border-box;
    overflow-y: auto;
  }
  #right-panel {
    flex-grow: 1;
    background: #222;
    padding: 20px;
    box-sizing: border-box;
    overflow-y: auto;
  }
  button {
    cursor: pointer;
  }
  ul {
    list-style: none;
    padding-left: 0;
  }
</style>
</head>
<body>
<div id="app">
  <div id="left-panel"></div>
  <div id="right-panel">
    <h1>Willkommen</h1>
    <p>Bitte melde dich links an.</p>
  </div>
</div>

<script>
const leftPanel = document.getElementById("left-panel");
const rightPanel = document.getElementById("right-panel");

const DEFAULT_USERS = [
  { id: "void", displayName: "Void Admin", role: "admin", show: { text: true, image: true, video: true }, text: "Admin Text", image: "", video: "" },
  { id: "user1", displayName: "User Eins", role: "user", show: { text: true, image: true, video: false }, text: "Hallo, ich bin User1.", image: "", video: "" },
  { id: "user2", displayName: "User Zwei", role: "user", show: { text: true, image: false, video: true }, text: "Hallo, ich bin User2.", image: "", video: "" }
];

let users = JSON.parse(JSON.stringify(DEFAULT_USERS));
let currentUserId = null;

// --- HILFSFUNKTIONEN ---

function findUser(id) {
  return users.find(u => u.id === id);
}

function logout() {
  currentUserId = null;
  renderLogin();
}

// --- RENDER ---

function renderLogin() {
  leftPanel.innerHTML = `
    <div class="w-full max-w-md mx-auto p-6 bg-black/80 border border-green-600 rounded-2xl shadow-2xl">
      <h2 class="text-3xl font-mono text-green-300 text-center">LOGIN</h2>
      <p class="text-sm text-green-200/70 text-center mb-4">Gib deine ID ein (z.B. <strong>void</strong> für Admin)</p>
      <div class="flex gap-2 mb-4">
        <input id="login-input" placeholder="user id" class="flex-1 bg-transparent border border-green-700 rounded px-3 py-2 text-green-200 font-mono" />
        <button id="login-btn" class="px-4 py-2 rounded bg-green-600/80 hover:bg-green-600 text-black font-semibold">Los</button>
      </div>
      <div class="text-xs text-green-300/70 font-mono">
        <div>Oder: Lade eine users.json Datei:</div>
        <div class="mt-2 flex gap-2">
          <input id="load-json-file" type="file" accept="application/json" class="text-green-400" />
          <button id="download-json" class="px-3 py-1 rounded border border-green-700">Aktuelle Nutzer herunterladen</button>
        </div>
      </div>
    </div>
  `;

  const loginInput = document.getElementById("login-input");
  const loginBtn = document.getElementById("login-btn");
  const loadJsonFile = document.getElementById("load-json-file");
  const downloadJson = document.getElementById("download-json");

  loginInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      login(loginInput.value.trim());
    }
  });
  loginBtn.addEventListener("click", () => {
    login(loginInput.value.trim());
  });
  loadJsonFile.addEventListener("change", (e) => {
    if (e.target.files && e.target.files[0]) {
      loadUsersFile(e.target.files[0]);
      e.target.value = null;
    }
  });
  downloadJson.addEventListener("click", () => {
    downloadUsersFile();
  });
}

function login(id) {
  if (!id) return alert("Bitte gib eine ID ein.");
  const user = findUser(id);
  if (!user) return alert("Benutzer nicht gefunden.");
  currentUserId = id;
  renderLoggedIn();
}

function renderLoggedIn() {
  const user = findUser(currentUserId);
  if (!user) {
    logout();
    return;
  }

  leftPanel.innerHTML = `
    <div class="w-full">
      <div class="flex items-center justify-between mb-4 text-green-200 font-mono">
        Eingeloggt als <strong>${user.displayName}</strong>
        <div class="flex gap-2">
          <button id="logout-btn" class="px-3 py-1 rounded border border-green-700">Logout</button>
          <label class="px-3 py-1 rounded border border-green-700 cursor-pointer">
            <input id="load-users-json" type="file" accept="application/json" class="hidden" />
            Nutzer laden
          </label>
          <button id="export-users-json" class="px-3 py-1 rounded border border-green-700">Nutzer exportieren</button>
        </div>
      </div>
      <div id="main-content" class="space-y-4"></div>
    </div>
  `;

  document.getElementById("logout-btn").addEventListener("click", logout);
  const loadUsersJson = document.getElementById("load-users-json");
  loadUsersJson.addEventListener("change", e => {
    if (e.target.files && e.target.files[0]) {
      loadUsersFile(e.target.files[0]);
      e.target.value = null;
    }
  });
  document.getElementById("export-users-json").addEventListener("click", downloadUsersFile);

  if (user.role === "admin") {
    renderVoidPanel();
  } else {
    renderUserViewReadonly();
  }
}

// Void Panel: Userliste ohne Edit/Delete, Klick loggt als User ein
function renderVoidPanel() {
  const main = document.getElementById("main-content");

  main.innerHTML = `<h3 class="text-xl font-mono text-green-200 mb-2">Void Übersicht — Benutzerliste</h3>`;

  const list = document.createElement("ul");
  list.className = "space-y-1 max-h-96 overflow-auto border border-green-700 rounded p-3 bg-black/70";

  users.forEach(u => {
    if (u.id === "void") return;

    const li = document.createElement("li");
    li.className = "cursor-pointer hover:text-green-400 font-mono text-green-300";
    li.textContent = `${u.displayName} (${u.id})`;
    li.title = `Klicke um als ${u.displayName} einzuloggen`;
    li.addEventListener("click", () => {
      currentUserId = u.id;
      renderLoggedIn();
    });
    list.appendChild(li);
  });

  main.appendChild(list);
}

// Normale User Ansicht: Nur Lesen, kein Bearbeiten
function renderUserViewReadonly() {
  const main = document.getElementById("main-content");
  const user = findUser(currentUserId);
  if (!user) return;

  main.innerHTML = `
    <h2 class="text-lg font-mono text-green-200 mb-2">${user.displayName} (${user.id})</h2>
    <div class="border border-green-700 rounded p-4 bg-black/70 space-y-4">
      ${user.show.text && user.text ? `<p>${user.text}</p>` : ""}
      ${user.show.image && user.image ? `<img src="${user.image}" alt="User Image" class="max-w-full rounded-md" />` : ""}
      ${user.show.video && user.video ? `<iframe width="320" height="180" src="${user.video}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="mt-2 rounded"></iframe>` : ""}
    </div>
  `;
}

// Lade Nutzer aus JSON Datei
function loadUsersFile(file) {
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const loadedUsers = JSON.parse(e.target.result);
      if (!Array.isArray(loadedUsers)) throw new Error("Ungültiges Format");
      users = loadedUsers;
      alert("Nutzer geladen.");
      if (currentUserId === null) renderLogin();
      else renderLoggedIn();
    } catch (err) {
      alert("Fehler beim Laden der Nutzer: " + err.message);
    }
  };
  reader.readAsText(file);
}

// Nutzer JSON herunterladen
function downloadUsersFile() {
  const a = document.createElement("a");
  const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(users, null, 2));
  a.setAttribute("href", dataStr);
  a.setAttribute("download", "users.json");
  document.body.appendChild(a);
  a.click();
  a.remove();
}

// Start
renderLogin();
</script>
</body>
</html>
